{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 450,
  "data": {
    "url": "https://raw.githubusercontent.com/kluk0007/kluk0007_Monash_FIT3179_A2/refs/heads/main/data/overseas_migrant_arrivals_age_and_sex.csv"
  },
  "params": [
    {
      "name": "yearSelection",
      "value": "2018-2019",
      "bind": {
        "input": "select",
        "options": ["2018-2019", "2022-2023", "2023-2024"],
        "name": "Select Year: "
      }
    }
  ],
  "transform": [
    {
      "calculate": "datum.Age == '100+' ? 100 : toNumber(datum.Age)",
      "as": "AgeNum"
    },
    {
      "calculate": "datum.AgeNum >= 100 ? '100+' : (floor(datum.AgeNum / 10) * 10 + '-' + (floor(datum.AgeNum / 10) * 10 + 9))",
      "as": "AgeGroup"
    },
    {
      "fold": [
        "2018-2019 Males Thousand",
        "2018-2019 Females Thousand",
        "2022-2023 Males Thousand",
        "2022-2023 Females Thousand",
        "2023-2024 Males Thousand",
        "2023-2024 Females Thousand"
      ],
      "as": ["Category", "Count"]
    },
    {
      "calculate": "split(datum.Category, ' ')[0]",
      "as": "Year"
    },
    {
      "calculate": "split(datum.Category, ' ')[1]",
      "as": "Gender"
    },
    {
      "filter": "datum.Year == yearSelection"
    }
  ],
  "spacing": 0,
  "hconcat": [
    {
      "transform": [{"filter": {"field": "Gender", "equal": "Males"}}],
      "title": "Males",
      "mark": "bar",
      "encoding": {
        "y": {
          "field": "AgeGroup",
          "sort": ["0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80-89","90-99","100+"],
          "axis": null,
          "title": null
        },
        "x": {
          "aggregate": "sum",
          "field": "Count",
          "title": "Overseas Migrant Arrivals (Thousand People)",
          "axis": {"format": "s"},
          "scale": {"reverse": true, "domain":[0, 200]}
        },
        "color": {
          "field": "Gender",
          "scale": {"range": ["#1f77b4", "#ff7f0e"]},
          "legend": null
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal", "title": "Year Period"},
          {"field": "Gender", "type": "nominal"},
          {"field": "AgeGroup", "type": "ordinal", "title": "Age Group"},
          {
            "aggregate": "sum",
            "field": "Count",
            "type": "quantitative",
            "title": "Overseas Migrant Arrivals (Thousand People)"
          }
        ]
      }
    },
    {
      "width": 45,
      "view": {"stroke": null},
      "mark": {
        "type": "text",
        "align": "center"
      },
      "encoding": {
        "y": {
          "field": "AgeGroup",
          "sort": ["0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80-89","90-99","100+"],
          "axis": null,
          "title": null
        },
        "text": {"field": "AgeGroup"}
      }
    },
    {
      "transform": [{"filter": {"field": "Gender", "equal": "Females"}}],
      "title": "Females",
      "mark": "bar",
      "encoding": {
        "y": {
          "field": "AgeGroup",
          "sort": ["0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80-89","90-99","100+"],
          "axis": null,
          "title": null
        },
        "x": {
          "aggregate": "sum",
          "field": "Count",
          "title": "Overseas Migrant Arrivals (Thousand People)",
          "scale": {"domain": [0, 200]},
          "axis": {"format": "s"}
        },
        "color": {
          "field": "Gender",
          "scale": {"range": ["#1f77b4", "#ff7f0e"]},
          "legend": null
        }
      }
    }
  ],
  "config": {
    "view": {"stroke": null},
    "axis": {"grid": false}
  }
}
