{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 500,
  "title": "Choropleth Map of Australian States (Time Slider)",
  "data": {
    "url": "https://raw.githubusercontent.com/kluk0007/kluk0007_Monash_FIT3179_A2/refs/heads/main/js/ne_1_australia.topojson",
    "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
  },
  "transform": [
    {"filter": "datum.properties.admin == 'Australia'"},
    {
      "lookup": "properties.name",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/kluk0007/kluk0007_Monash_FIT3179_A2/refs/heads/main/data/net_overseas_migration_all_states_year_ending_transposed.csv"
        },
        "key": "States",
        "fields": [
          "Jun-14","Sep-14","Dec-14","Mar-15","Jun-15",
          "Sep-15","Dec-15","Mar-16","Jun-16","Sep-16","Dec-16","Mar-17","Jun-17","Sep-17","Dec-17","Mar-18","Jun-18","Sep-18","Dec-18","Mar-19","Jun-19","Sep-19","Dec-19","Mar-20","Jun-20","Sep-20","Dec-20","Mar-21","Jun-21","Sep-21","Dec-21","Mar-22","Jun-22","Sep-22","Dec-22","Mar-23","Jun-23","Sep-23","Dec-23","Mar-24","Jun-24"
        ]
      }
    },
    {
      "fold": [
        "Jun-14","Sep-14","Dec-14","Mar-15","Jun-15",
        "Sep-15","Dec-15","Mar-16","Jun-16","Sep-16","Dec-16","Mar-17","Jun-17","Sep-17","Dec-17","Mar-18","Jun-18","Sep-18","Dec-18","Mar-19","Jun-19","Sep-19","Dec-19","Mar-20","Jun-20","Sep-20","Dec-20","Mar-21","Jun-21","Sep-21","Dec-21","Mar-22","Jun-22","Sep-22","Dec-22","Mar-23","Jun-23","Sep-23","Dec-23","Mar-24","Jun-24"
      ],
      "as": ["Month", "Value"]
    },
    {
      "calculate": "['Jun-14','Sep-14','Dec-14','Mar-15','Jun-15','Sep-15','Dec-15','Mar-16','Jun-16','Sep-16','Dec-16','Mar-17','Jun-17','Sep-17','Dec-17','Mar-18','Jun-18','Sep-18','Dec-18','Mar-19','Jun-19','Sep-19','Dec-19','Mar-20','Jun-20','Sep-20','Dec-20','Mar-21','Jun-21','Sep-21','Dec-21','Mar-22','Jun-22','Sep-22','Dec-22','Mar-23','Jun-23','Sep-23','Dec-23','Mar-24','Jun-24'][monthIndex]",
      "as": "selectedMonth"
    },
    {"filter": "datum.Month == datum.selectedMonth"},
    { "calculate": "abs(datum.Value)", "as": "AbsValue" },
    { "joinaggregate": [{"op": "sum", "field": "AbsValue", "as": "total_abs_value"}]
    },
    {"calculate": "(datum.Value / datum.total_abs_value) * 100", "as": "percent_value" }
  ],
  "params": [
    {
      "name": "monthIndex",
      "value": 0,
      "bind": {
        "input": "range",
        "min": 0,
        "max": 40,
        "step": 1,
        "name": "Month Index: "
      }
    }
  ],
  "projection": {"type": "mercator"},
  "mark": {"type": "geoshape", "stroke": "white"},
  "encoding": {
    "color": {
      "field": "percent_value",
      "type": "quantitative",
      "title": "Percentage (%)",
      "scale": {"range":["#ff4a4a", "#ffffff", "#3da5ff"], "domain":[-50, 0, 50]}
    },
    "tooltip": [
      {"field": "properties.name", "title": "State"},
      {"field": "Value", "title": "Net Migration (Thousand People"},
      {"field": "percent_value", "title": "Percentage", "format": ".2f"},
      {"field": "Month", "title": "Month-Year"}
    ]
  }
}
